# Service: pricing
# File: pricing_routes.conf
# Description: Nginx route configurations for pricing service endpoints

# Preview Pricing Endpoint
# Allows clients to preview pricing before making a purchase
location = /api/v3/pricing/preview_pricing {
    limit_except OPTIONS POST {
        deny all;
    }

    # Apply rate limiting
    limit_req zone=pricing burst=5 nodelay;
    limit_req_status 429;

    # CORS headers (if needed)
    add_header Access-Control-Allow-Origin * always;
    add_header Access-Control-Allow-Methods "POST, OPTIONS" always;
    add_header Access-Control-Allow-Headers "Content-Type, Authorization" always;

    # Handle OPTIONS preflight requests
    if ($request_method = OPTIONS) {
        add_header Access-Control-Allow-Origin * always;
        add_header Access-Control-Allow-Methods "POST, OPTIONS" always;
        add_header Access-Control-Allow-Headers "Content-Type, Authorization" always;
        add_header Content-Length 0;
        add_header Content-Type text/plain;
        return 204;
    }

    # Execute Lua route handler
    content_by_lua_file $lua_src_path/pricing/routes/PreviewPricing.lua;
}

# Health Check Endpoint
# Simple endpoint to check if the service is running
location = /api/v3/pricing/health {
    limit_except GET {
        deny all;
    }

    default_type application/json;
    return 200 '{"status":"ok","service":"pricing"}';
}

# API Documentation Endpoint (if Swagger is available)
location = /api/v3/pricing/docs {
    limit_except GET {
        deny all;
    }

    # In production, this would serve Swagger UI
    default_type text/html;
    return 200 '<html><body><h1>Pricing Service API Documentation</h1><p>API documentation would be served here.</p></body></html>';
}
